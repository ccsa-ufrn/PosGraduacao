{% extends "admin/layout.html" %}

{% block styles %}
<link rel="stylesheet" type="text/css" href="/static/posgraduacao/css/{{ post_graduation }}.css"/>
{% endblock %}

{% block scripts %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/js/select2.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    $("input[name=create]").val("Deletar");
    var scheduledReports = {{ final_reports|tojson|safe }};
    var scheduledReports = JSON.parse(scheduledReports);
    var listOfTitles = [];
    for( i = 0; i < scheduledReports.scheduledReports.length; i++){ 
        if (!(scheduledReports.scheduledReports[i].hasOwnProperty('deleted'))){ 
        listOfTitles.push({
            id: i,
            text: (scheduledReports.scheduledReports[i].title)
            })
        }
    }
    $("#list").select2({
        data: listOfTitles
    });
    $("button").click(function() {
        var indexInReports = $("select#list").val();
        var title = scheduledReports.scheduledReports[indexInReports].title;
        var dateTime = scheduledReports.scheduledReports[indexInReports].time;
        var location = scheduledReports.scheduledReports[indexInReports].location;
        var author = scheduledReports.scheduledReports[indexInReports].author;
        dateTime = new Date(dateTime.$date);
        dateTime.setHours(dateTime.getHours() + 3);
        var date = dateTime.toLocaleDateString();
        var time = dateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        $("#form-edit").css("visibility", "visible");
        $("input[name=title]").val(title);
        $("input[name=location]").val(location);
        $("input[name=author]").val(author);
        $("input[name=date]").val(date);
        $("input[name=time]").val(time);
        $("input[name=index]").val(indexInReports);
        console.log($("input[name=index]").val());
        
    });
});
</script>
{% endblock %}

{% block content %}
<div class="col-md-12">
<div class="panel panel-danger" style="margin-left: -4%">
<div class="panel-heading text-center">
    <h4>Deletar agendamento<h4/>
</div>
<div class="panel-body">
<div class="col-md-10">
<h5>Selecione o agendamento</h5>
<select id="list"></select>
</br>
</br>
<button id="edit" type="button" class="btn btn-default">Selecionar</button>
</div>
<div class="col-md-10">
<form method="POST" id="form-edit" action="{{ url_for('crud_scheduled_reports.delete_scheduled_reports') }}">
    <div class="form-group">
    {{ form.csrf_token }}
    {{ form.index(required='true', style="display:none;") }}
    <br/>
    {{ form.title.label }}
    {{ form.title(required='true', class="form-control", readonly="readonly") }}
    <br/>
    {{ form.author.label }}
    {{ form.author(required='true', class="form-control", readonly="readonly") }}
    <br/>
    {{ form.location.label }}
    {{ form.location(required='true', class="form-control", readonly="readonly") }}
    <br/>
    {{ form.date.label }}
    {{ form.date(required='true', class="form-control", readonly="readonly") }}
    <br/>
    <br/>
    {{ form.time.label }}
    {{ form.time(required='true', type="time", class="form-control", readonly="readonly") }}
    <br/>
    {{ form.create(class="form-control") }}
    </div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
{% endblock %}
